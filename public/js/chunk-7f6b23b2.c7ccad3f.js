(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7f6b23b2"],{"6f32":function(t,e,s){"use strict";s("e692")},8060:function(t,e,s){"use strict";s.r(e);var r=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"flex flex-wrap items-center mb-6"},[s("div",{staticClass:"flex-grow"},[s("div",{staticClass:"flex flex-wrap "},[s("h2",{staticClass:"font-bold",staticStyle:{"line-height":"48px !important",display:"flex","vertical-align":"middle !important"}},[s("vs-icon",{staticClass:"inline pt-2 mr-4",attrs:{size:"32px",icon:"view_quilt"}}),t._v("\n          Stock Requests\n        ")],1),s("v-select",{staticClass:"flex ml-4",attrs:{options:t.availableDepots,name:"depot_name",label:"depot_name",clearable:!1,placeholder:"Depot"},on:{input:function(e){return t.fetchStockRequests()}},model:{value:t.selectedDepot,callback:function(e){t.selectedDepot=e},expression:"selectedDepot"}}),s("vs-button",{staticClass:"py-0 ml-4",attrs:{icon:"refresh",type:"flat"},on:{click:function(e){return t.fetchStockRequests()}}},[t._v("Refresh")])],1)]),s("vs-button",{staticClass:"mr-4 vs-con-loading__container",attrs:{icon:"add",id:"customerLoading"},on:{click:t.showRequestForm}},[t._v("Request Stock\n    ")])],1),s("vx-card",[s("div",{staticClass:"px-6 py-6 rounded"},[s("vs-table",{attrs:{stripe:"",data:t.stockRequests},on:{selected:t.showRequestDetails},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.data;return t._l(r,(function(e,a){return s("vs-tr",{key:a,attrs:{data:e}},[s("vs-td",[t._v("\n              "+t._s(r[a].staff?r[a].staff.staff_name:"Unknown Staff")+"\n            ")]),s("vs-td",[s("span",{staticStyle:{color:"#0d77e4","font-weight":"bold"}},[t._v(" "+t._s(r[a].created_at)+" ")])]),s("vs-td",[s("vs-chip",{attrs:{color:e.approved?"#cdf7ec":"#fff4f6"}},[s("span",{class:e.approved?"success-text":"danger-text",staticStyle:{"font-weight":"bold","margin-left":"4px"}},[t._v("\n                  "+t._s(e.approved?"Approved":e.rejected?"Rejected":"Not Approved")+"\n                 ")])])],1),s("vs-td",[s("vs-chip",{attrs:{color:e.dispatched?"#cdf7ec":"#f9eae4"}},[s("span",{class:e.dispatched?"success-text":"neutral-text",staticStyle:{"font-weight":"bold","margin-left":"4px"}},[t._v("\n                        "+t._s(e.dispatched?"Dispatched":"Not Dispatched")+"\n                ")])])],1)],1)}))}}]),model:{value:t.selectedRequest,callback:function(e){t.selectedRequest=e},expression:"selectedRequest"}},[s("template",{slot:"thead"},[s("vs-th",[t._v("Staff ")]),s("vs-th",[t._v(" Date ")]),s("vs-th",[t._v(" Approval ")]),s("vs-th",[t._v(" Dispatch Status ")])],1)],2)],1)]),s("vs-popup",{attrs:{fullscreen:"",title:"Request Stock",active:t.orderFormDialog},on:{close:function(e){return t.closeRequestForm()},"update:active":function(e){t.orderFormDialog=e}}},[s("div",{staticClass:"md:px-6"},[s("div",{staticClass:"vx-row"},[s("div",{staticClass:"vx-col md:w-1/3 w-1/4"},[s("h3",[t._v("Products To Request")]),t._l(t.orderedProductsGrouped,(function(e,r){return s("div",{key:r,staticClass:"category-itemm"},[s("vs-card",{staticClass:"my-6"},[s("div",{staticClass:"flex flex-wrap"},[s("table",{staticClass:"cartProductTable mt-1 flex-grow"},[s("tr",[s("td",[t._v("Product ")]),s("td",[t._v(t._s(e.product.product_name)+", "+t._s(e.variant.variant_name))]),s("td",[s("vs-button",{staticClass:"px-2 py-1",attrs:{type:"flat",color:"danger"},on:{click:function(e){return t.removeFromCart(r)}}},[t._v("\n                        Remove\n                      ")])],1)]),s("tr",{staticStyle:{"background-color":"#f2f2f2"}},[s("td",[t._v("Quantity:")]),s("td",[t._v(t._s(e.quantity))]),s("td")]),s("tr",[s("td",[t._v("Number of Orders:")]),s("td",[t._v(t._s(e.ordered_products.length)+"\n                      "),e.ordered_products.length>0?s("vs-button",{staticClass:"px-2 py-1",attrs:{type:"flat",color:"secondary"},on:{click:function(s){return t.showOrdersForProduct(e)}}},[t._v("\n                         Show Orders\n                      ")]):t._e()],1)])])])])],1)})),t.orderedProductsGrouped.length>0?s("div",[s("vs-button",{ref:"saveButton",staticClass:"mr-4 mb-4",attrs:{color:"success"},on:{click:function(e){return t.submitRequest()}}},[t._v("\n              Submit Request\n            ")])],1):t._e()],2),s("div",{staticClass:"vx-col md:w-1/3 w-1/4"},[s("div",{staticClass:"mx-6 px-6"},[s("h3",[t._v("Add Product")]),s("div",{staticClass:"mt-4 mb-5"},[s("label",{staticClass:"vs-input--label"},[t._v("Product")]),s("v-select",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{clearable:!1,options:t.products,name:"Product",label:"product_name",placeholder:"Select"},on:{input:function(e){return t.fetchProductVariants()}},model:{value:t.selectedOrderProduct,callback:function(e){t.selectedOrderProduct=e},expression:"selectedOrderProduct"}}),s("span",{directives:[{name:"show",rawName:"v-show",value:t.errors.has("Product"),expression:"errors.has('Product')"}],staticClass:"text-danger text-sm"},[t._v(t._s(t.errors.first("Product")))])],1),s("div",{staticClass:"mt-4 mb-5"},[s("label",{staticClass:"vs-input--label"},[t._v("Product Variant")]),s("v-select",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{clearable:!1,options:t.productVariants,name:"Variant",label:"variant_name",placeholder:"Select"},model:{value:t.selectedOrderProductVariant,callback:function(e){t.selectedOrderProductVariant=e},expression:"selectedOrderProductVariant"}}),s("span",{directives:[{name:"show",rawName:"v-show",value:t.errors.has("Variant"),expression:"errors.has('Variant')"}],staticClass:"text-danger text-sm"},[t._v(t._s(t.errors.first("Variant")))])],1),s("div",{staticClass:"mt-4 mb-5"},[s("vs-input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],staticClass:"w-full mt-4",attrs:{label:"Quantity",name:"quantity"},model:{value:t.quantity,callback:function(e){t.quantity=e},expression:"quantity"}}),s("span",{directives:[{name:"show",rawName:"v-show",value:t.errors.has("quantity"),expression:"errors.has('quantity')"}],staticClass:"text-danger text-sm"},[t._v("\n                 "+t._s(t.errors.first("quantity"))+" ")])],1),t.selectedOrderProduct&&t.selectedOrderProductVariant&&t.quantity>0?s("div",[s("vs-button",{ref:"saveButton",staticClass:"mr-4 mb-4",attrs:{color:"secondary"},on:{click:function(e){return t.addProductToCart()}}},[t._v("\n                Add to cart\n              ")])],1):t._e()])])])]),s("vs-popup",{attrs:{title:"Orders",active:t.ordersDialog},on:{close:function(e){t.ordersDialog=!1},"update:active":function(e){t.ordersDialog=e}}},[s("div",t._l(t.orderedProductVariant.ordered_products,(function(e,r){return s("vs-card",{key:r},[s("table",{staticClass:"cartProductTable mt-1 flex-grow"},[s("tr",[s("td",[t._v("Customer ")]),s("td",[t._v(t._s(e.order.customer.customer_name)+", "+t._s(e.order.customer.phone_number_1))])]),s("tr",[s("td",[t._v("Ordered Quantity ")]),s("td",[t._v(t._s(e.ordered_quantity))])])])])})),1)])],1)],1)},a=[],o=s("bb36"),c=s("4a7a"),i=s.n(c),n=s("2567"),d=s("82be"),l={components:{Table:d["a"],vSelect:i.a},data:function(){return{stockRequests:[],productInstance:{id:null,product_name:null,vendor_id:1,is_published:!1,categories_ids:[]},productFormDialog:!1,placesVisible:!1,placesFormVisible:!1,placeInstance:{id:null,place_name:null,district_id:null},places:[],productCategoriesArray:[{title:"Main Category",id:null,selected_category:null,selected_category_id:null,sub_categories:[]}],availableVendors:[],selectedVendor:null,assignedCategories:[],productVariantsVisible:!1,availableCategories:[],selectedCategory:{category_name:"All Categories"},availableDepots:[],selectedDepot:{depot_name:"All Depots"},selectedRequest:{},orderedProductsGrouped:[],orderedProductVariant:{},orderFormDialog:!1,cartProducts:[],quantity:1,selectedOrderProduct:null,selectedOrderProductVariant:null,ordersDialog:!1,products:[],productVariants:[]}},methods:{fetchStockRequests:function(){var t=this;this.stockRequests=[],this.$vs.loading({color:"secondary"});var e="/products/inventory/stock/requests?depot_id=";o["a"].get(e).then((function(e){t.$vs.loading.close(),t.stockRequests=e.data.payload.requests.data})).catch((function(e){t.$vs.loading.close(),t.handleApiError(e)}))},showRequestDetails:function(){this.$router.push({name:"products-inventory-stock-request-details",params:{selectedRequest:this.selectedRequest}})},closeProductForm:function(){this.productFormDialog=!1},showRequestForm:function(){this.orderFormDialog=!0,this.getOrderedProductsGrouped()},getOrderedProductsGrouped:function(){var t=this;this.orderedProductsGrouped=[],this.$vs.loading({color:"secondary"});var e="/products/inventory/stock/init/request";o["a"].get(e).then((function(e){t.$vs.loading.close(),t.orderedProductsGrouped=e.data.payload.ordered_variants})).catch((function(e){t.$vs.loading.close(),t.handleApiError(e)}))},closeRequestForm:function(){this.orderFormDialog=!1},addProductToCart:function(){var t={product:this.selectedOrderProduct,variant:this.selectedOrderProductVariant,quantity:this.quantity,ordered_products:[],ordered_products_ids:[]};this.selectedOrderProduct=null,this.selectedOrderProductVariant=null,this.quantity=1,this.$vs.notify({title:"Success",text:"Added to list",color:"success"}),this.orderedProductsGrouped.push(t)},removeFromCart:function(t){console.log(t),this.orderedProductsGrouped.splice(t,1),this.$vs.notify({title:"Success",text:"Removed",color:"success"})},submitRequest:function(){var t=this,e=this.orderedProductsGrouped.map((function(t){return{ordered_products_ids:t.ordered_products_ids,variant_id:t.variant.id,quantity:t.quantity}})),s={depot_id:null,product_variants:e};console.log(JSON.stringify(s)),o["a"].post("/products/inventory/stock/request",s).then((function(e){t.closeRequestForm(),t.happilyNotify("Request Sent"),t.fetchStockRequests()})).catch((function(e){console.log(e),t.handleApiError(e)}))},showOrdersForProduct:function(t){this.orderedProductVariant=t,this.ordersDialog=!0},closeProductVariantsDialog:function(){this.productVariantsVisible=!1,this.fetchStockRequests()},showProductVariants:function(t){this.productInstance=t,this.productVariantsVisible=!0},getAvailableCategories:function(t){var e=this,s=this.productCategoriesArray[t].id;o["a"].get("/resources/products/categories?parent_id="+s).then((function(s){e.productCategoriesArray[t].sub_categories=s.data.payload.categories})).catch((function(t){console.log(t)}))},fetchSubCategories:function(t){var e=this;o["a"].get("/resources/products/categories?parent_id="+t.selected_category.id).then((function(s){var r=s.data.payload.categories;if(r.length>0){console.log("Has sub categories");var a={};a.id=t.id,a.title=t.selected_category.category_name,a.selected_category_id=t.null,a.sub_categories=r,e.productCategoriesArray.push(a)}})).catch((function(t){console.log(t)}))},fetchAvailableCategories:function(){var t=this;o["a"].get("/resources/products/categories/all").then((function(e){t.availableCategories=e.data.payload.categories,t.availableCategories.push(t.selectedCategory)})).catch((function(t){console.log(t)}))},fetchAvailableVendors:function(){var t=this;o["a"].get("/resources/products/vendors/all").then((function(e){t.availableVendors=e.data.payload.vendors})).catch((function(t){console.log(t)}))},fetchAvailableDepots:function(){var t=this;console.info("fetching depots.."),console.info(JSON.stringify(this.selectedDepot)),o["a"].get("/resources/assets/depots").then((function(e){t.availableDepots=e.data.payload.depots.data,t.availableDepots.push(t.selectedDepot),t.selectedDepot=t.availableDepots[0]})).catch((function(t){console.log(t)}))},fetchProducts:function(){var t=this;o["a"].get("/resources/products/products?category_id=").then((function(e){t.products=e.data.payload.products.data})).catch((function(e){t.handleApiError(e)}))},fetchProductVariants:function(){var t=this;this.$vs.loading({color:"secondary"}),this.productVariants=[],this.selectedOrderProductVariant=null,o["a"].get("/resources/product/variants?product_id="+this.selectedOrderProduct.id).then((function(e){t.$vs.loading.close(),t.productVariants=e.data.payload.product_variants})).catch((function(e){t.$vs.loading.close(),t.handleApiError(e)}))},handleApiError:function(t){this.$vs.notify({title:"Error",text:Object(n["a"])(t),iconPack:"feather",icon:"icon-alert-circle",color:"danger"})},happilyNotify:function(t){this.$vs.notify({title:"Success",text:t,color:"success"})},sadlyNotify:function(t){this.$vs.notify({title:"Error",text:t,color:"danger",position:"bottom-left"})}},created:function(){this.getAvailableCategories(0),this.fetchAvailableVendors(),this.fetchAvailableCategories(),this.fetchAvailableDepots(),this.fetchProducts()},mounted:function(){this.fetchStockRequests()}},u=l,p=(s("6f32"),s("2877")),v=Object(p["a"])(u,r,a,!1,null,"6cc893b4",null);e["default"]=v.exports},e692:function(t,e,s){}}]);
//# sourceMappingURL=chunk-7f6b23b2.c7ccad3f.js.map