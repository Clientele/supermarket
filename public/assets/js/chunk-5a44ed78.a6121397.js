(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5a44ed78"],{"1b1e":function(e,t,s){"use strict";s("3c0c")},"3c0c":function(e,t,s){},b3b4:function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"data-list-container",attrs:{id:"data-list-list-view"}},[s("div",{staticClass:"flex flex-wrap-reverse items-center flex-grow justify-between mb-6"},[s("div",{staticClass:"flex flex-wrap-reverse items-center data-list-btn-container"},[s("vs-icon",{staticClass:"mr-2",attrs:{icon:"shopping_cart",size:"large",color:"primary"}}),s("h1",{staticClass:"mr-6"},[e._v("\n        Orders\n      ")]),s("v-select",{staticClass:"mr-6",attrs:{clearable:!1,reduce:function(e){return e.id},options:e.availableRegions,label:"region_name"},model:{value:e.selectedOrderRegionId,callback:function(t){e.selectedOrderRegionId=t},expression:"selectedOrderRegionId"}}),s("vs-button",{staticClass:"mr-4 vs-con-loading__container",attrs:{icon:"add",id:"customerLoading"},on:{click:e.showOrderForm}},[e._v("Add Order\n      ")])],1)]),s("vs-card",[s("vs-table",{ref:"table",attrs:{pagination:"","max-items":100,search:"",data:e.orders},on:{selected:e.showOrderDetails},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.data;return[s("tbody",e._l(r,(function(t,r){return s("vs-tr",{key:r,attrs:{data:t}},[s("vs-td",[s("p",{staticClass:"product-name font-medium truncate"},[e._v(e._s(t.id))])]),s("vs-td",[s("p",{staticClass:"product-name font-medium truncate"},[e._v(e._s(t.customer?t.customer.customer_name:" "))])]),s("vs-td",[s("p",{staticClass:"product-category"},[e._v("\n              "+e._s(t.place?t.place.place_name:" ")+"\n              "+e._s(t.district?t.district.district_name:" ")+"\n              "+e._s(t.region?t.region.region_name:" ")+"\n            ")])]),s("vs-td",[t.staff?s("vs-chip",{attrs:{color:"secondary"}},[s("vs-avatar",{attrs:{color:"secondary","icon-pack":"feather",icon:"icon-user"}}),e._v("\n              "+e._s(t.staff.staff_name)+"\n            ")],1):s("vs-chip",{attrs:{color:"grey"}},[e._v(" No Salesman")])],1),s("vs-td",[s("span",{class:t.is_cancelled?"text-danger":"text-primary"},[e._v(" "+e._s(t.order_status))])]),s("vs-td",{staticClass:"whitespace-no-wrap"},[s("vs-button",{staticClass:"mr-2",attrs:{color:"secondary",size:"small",type:"border"}},[e._v("View\n            ")])],1)],1)})),1)]}}]),model:{value:e.selectedOrder,callback:function(t){e.selectedOrder=t},expression:"selectedOrder"}},[s("template",{slot:"thead"},[s("vs-th",[e._v("#")]),s("vs-th",[e._v("Customer")]),s("vs-th",[e._v("Address")]),s("vs-th",[e._v("Sales Person")]),s("vs-th",[e._v("Status")]),s("vs-th",[e._v("Action")])],1)],2)],1),s("vs-popup",{attrs:{fullscreen:"",title:"New Order",active:e.orderFormDialog},on:{close:function(t){return e.closeOrderForm()},"update:active":function(t){e.orderFormDialog=t}}},[s("div",{staticClass:"md:px-6"},[s("div",{staticClass:"vx-row"},[s("div",{staticClass:"vx-col md:w-1/3 w-1/4"},[s("div",{staticClass:"mt-4 mb-5"},[s("h3",[e._v("Customer")]),e.selectedOrderCustomer?e._e():s("vs-input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],staticClass:"mt-5 w-full",attrs:{name:"location"},model:{value:e.customerQuery,callback:function(t){e.customerQuery=t},expression:"customerQuery"}}),e._l(e.customers,(function(t,r){return s("div",{key:r,staticClass:"location-item px-2 py-2 rounded mt-4",on:{click:function(s){return e.pickCustomer(t)}}},[s("ul",[s("li",[e._v(e._s(t.customer_name)+" "+e._s(t.email))]),s("li",[e._v(e._s(t.phone_number_1)+" "+e._s(t.phone_number_2))]),s("li",[e._v("\n                  "+e._s(t.region?t.region.region_name:" ")+"\n                  "+e._s(t.district?t.district.distrcit_name:" ")+"\n                  "+e._s(t.place?t.place.place_name:" ")+"\n                ")])])])})),e.selectedOrderCustomer?s("div",{staticClass:"selectedOrder-address px-2 py-2 rounded mt-4"},[s("div",{staticClass:"flex flex-wrap items-center"},[s("div",{staticClass:"flex-grow"},[e._v("\n                  "+e._s(e.selectedOrderCustomer.customer_name)+"\n                ")]),s("vs-button",{attrs:{color:"danger",type:"flat","icon-pack":"feather",icon:"icon-x"},on:{click:function(t){return e.removeCustomer()}}})],1)]):e._e()],2),s("div",{staticClass:"mt-4 mb-5"},[s("h3",[e._v("Delivery Address")]),e.selectedOrderAddress?e._e():s("vs-input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],staticClass:"mt-5 w-full",attrs:{name:"location"},model:{value:e.locationQuery,callback:function(t){e.locationQuery=t},expression:"locationQuery"}}),s("span",{directives:[{name:"show",rawName:"v-show",value:e.errors.has("location"),expression:"errors.has('location')"}],staticClass:"text-danger text-sm"},[e._v(e._s(e.errors.first("item-name")))]),e._l(e.addresses,(function(t,r){return s("div",{key:r,staticClass:"location-item px-2 py-2 rounded mt-4",on:{click:function(s){return e.pickAddress(t)}}},[s("ul",[s("li",[e._v(e._s(t.location_name))])])])})),e.selectedOrderAddress?s("div",{staticClass:"selectedOrder-address px-2 py-2 rounded mt-4"},[s("div",{staticClass:"flex flex-wrap items-center"},[s("div",{staticClass:"flex-grow"},[e._v("\n                  "+e._s(e.selectedOrderAddress.location_name)+"\n                ")]),s("vs-button",{attrs:{color:"danger",type:"flat","icon-pack":"feather",icon:"icon-x"},on:{click:function(t){return e.removeAddress()}}})],1)]):e._e()],2)]),s("div",{staticClass:"vx-col md:w-1/3 w-1/4"},[s("div",{staticClass:"mx-6 px-6"},[s("h3",[e._v("Pick Product")]),s("div",{staticClass:"mt-4 mb-5"},[s("label",{staticClass:"vs-input--label"},[e._v("Product")]),s("v-select",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{clearable:!1,options:e.products,name:"Product",label:"product_name",placeholder:"Select"},on:{input:function(t){return e.fetchProductVariants()}},model:{value:e.selectedOrderProduct,callback:function(t){e.selectedOrderProduct=t},expression:"selectedOrderProduct"}}),s("span",{directives:[{name:"show",rawName:"v-show",value:e.errors.has("Product"),expression:"errors.has('Product')"}],staticClass:"text-danger text-sm"},[e._v(e._s(e.errors.first("Product")))])],1),s("div",{staticClass:"mt-4 mb-5"},[s("label",{staticClass:"vs-input--label"},[e._v("Product Variant")]),s("v-select",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{clearable:!1,options:e.productVariants,name:"Variant",label:"variant_name",placeholder:"Select"},model:{value:e.selectedOrderProductVariant,callback:function(t){e.selectedOrderProductVariant=t},expression:"selectedOrderProductVariant"}}),s("span",{directives:[{name:"show",rawName:"v-show",value:e.errors.has("Variant"),expression:"errors.has('Variant')"}],staticClass:"text-danger text-sm"},[e._v(e._s(e.errors.first("Variant")))])],1),s("div",{staticClass:"mt-4 mb-5"},[s("vs-input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],staticClass:"w-full mt-4",attrs:{label:"Quantity",name:"quantity"},model:{value:e.quantity,callback:function(t){e.quantity=t},expression:"quantity"}}),s("span",{directives:[{name:"show",rawName:"v-show",value:e.errors.has("quantity"),expression:"errors.has('quantity')"}],staticClass:"text-danger text-sm"},[e._v("\n                 "+e._s(e.errors.first("quantity"))+" ")])],1),e.selectedOrderProduct&&e.selectedOrderProductVariant&&e.quantity>0?s("div",[s("vs-button",{ref:"saveButton",staticClass:"mr-4 mb-4",attrs:{color:"secondary"},on:{click:function(t){return e.addProductToCart()}}},[e._v("\n                Add to cart\n              ")])],1):e._e()])]),s("div",{staticClass:"vx-col md:w-1/3 w-1/4"},[s("h3",[e._v("Cart")]),e._l(e.cartProducts,(function(t,r){return s("div",{key:r,staticClass:"category-item"},[s("vs-card",{staticClass:"my-6"},[s("div",{staticClass:"flex flex-wrap"},[s("p",{staticClass:"mt-1 flex-grow"},[e._v("\n                  "+e._s(t.product.product_name)+"\n                  "+e._s(t.productVariant.variant_name)+",\n                  QTY: "+e._s(t.quantity)+"\n                ")]),s("vs-button",{attrs:{type:"border",color:"danger",radius:"",icon:"close",size:"small"},on:{click:function(t){return e.removeFromCart(r)}}})],1)])],1)})),e.cartProducts.length>0?s("div",[s("vs-button",{ref:"saveButton",staticClass:"mr-4 mb-4",attrs:{color:"success"},on:{click:function(t){return e.submitOrder()}}},[e._v("\n              Submit Order\n            ")])],1):e._e()],2)]),s("div",{staticClass:"vx-row mt-12"},[s("div",{staticClass:"vx-col w-full"},[s("div",{staticClass:"flex items-start flex-col sm:flex-row"})])])])]),s("vs-popup",{attrs:{fullscreen:"",title:"Order Details",active:e.orderDetailsVisible},on:{close:function(t){return e.closeOrderDetails()},"update:active":function(t){e.orderDetailsVisible=t}}},[s("div",{staticStyle:{"min-height":"100vh"}},[s("div",{staticClass:"vx-row"},[s("div",{staticClass:"vx-col md:w-1/3"},[s("div",{staticClass:"mb-6"},[s("span",{staticClass:"font-bold"},[e._v("Customer")])]),s("div",[s("table",[s("tr",[s("td",{staticClass:"pr-6"},[e._v("Name")]),s("td",[e._v(e._s(e.selectedOrder.customer?e.selectedOrder.customer.customer_name:"No Customer"))])]),s("tr",[s("td",{staticClass:"pr-6"},[e._v("Phone")]),s("td",[e._v("\n                  "+e._s(e.selectedOrder.customer?e.selectedOrder.customer.phone_number_1:"No Phone")+"\n                  "+e._s(e.selectedOrder.customer?e.selectedOrder.customer.phone_number_2:"")+"\n                ")])]),s("tr",[s("td",{staticClass:"pr-6"},[e._v("Email")]),s("td",[e._v("\n                  "+e._s(e.selectedOrder.customer?e.selectedOrder.customer.email:"Email")+"\n                ")])]),s("tr",[s("td",{staticClass:"pr-6"},[e._v("Address")]),s("td",[e._v("\n                  "+e._s(e.selectedOrder.place?e.selectedOrder.place.place_name:" ")+"\n                  "+e._s(e.selectedOrder.district?e.selectedOrder.district.district_name:" ")+"\n                  "+e._s(e.selectedOrder.region?e.selectedOrder.region.region_name:" ")+"\n                ")])])])]),e.selectedOrder.is_cancelled?e._e():s("vs-button",{staticClass:"mt-12",attrs:{color:"danger"},on:{click:function(t){return e.rejectOrder()}}},[e._v(" Cancel Order")])],1),e.selectedOrder.order_products?s("div",{staticClass:"vx-col md:w-1/3 "},[s("div",{staticClass:"mb-6"},[s("span",{staticClass:"font-bold"},[e._v("Ordered Products")])]),e._l(e.selectedOrder.order_products,(function(t,r){return s("vx-card",{staticClass:"overflow-hidden mb-6"},[s("div",{attrs:{slot:"no-body"},slot:"no-body"},[s("div",{staticClass:"p-6 flex justify-between flex-row-reverse items-center"},[s("feather-icon",{staticClass:"p-3 inline-flex rounded-full text-primary",style:{background:"rgba(var(--vs-primary),.15)"},attrs:{icon:"PackageIcon"}}),s("div",{staticClass:"truncate"},[s("h3",{staticClass:"mb-1 font-bold"},[e._v("\n                    "+e._s(t.product?t.product.product_name:"")+"\n                    "+e._s(t.variant?t.variant.variant_name:" ")+"\n                  ")]),s("ul",[s("li",[e._v("Quantity "+e._s(t.ordered_quantity))]),s("li",[e._v("Delivered: "+e._s(t.delivered_quantity))]),s("li",[e._v("@TSH"+e._s(t.selling_price))])])])],1)])])}))],2):e._e(),e.selectedOrder.order_products?s("div",{staticClass:"vx-col md:w-1/3 "},[s("div",{staticClass:"mb-6"},[s("span",{staticClass:"font-bold"},[e._v("Sales Person")])]),s("table",[s("tr",[s("td",{staticClass:"pr-6"},[e._v("Name")]),s("td",[e._v(e._s(e.selectedOrder.staff?e.selectedOrder.staff.staff_name:"No sales person"))])]),s("tr",[s("td",{staticClass:"pr-6"},[e._v("Phone")]),s("td",[e._v(" "+e._s(e.selectedOrder.staff?e.selectedOrder.staff.phone_number:"No Phone"))])])]),s("div",{staticClass:"mt-4 mb-5"},[s("label",{staticClass:"vs-input--label"},[e._v("Update Sales Person")]),s("v-select",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{clearable:!1,options:e.availableStaff,name:"Staff",label:"staff_name",placeholder:"Select"},on:{input:function(t){return e.setSalesPerson()}},model:{value:e.selectedStaff,callback:function(t){e.selectedStaff=t},expression:"selectedStaff"}}),s("span",{directives:[{name:"show",rawName:"v-show",value:e.errors.has("Staff"),expression:"errors.has('Staff')"}],staticClass:"text-danger text-sm"},[e._v(e._s(e.errors.first("Staff")))])],1)]):e._e()])])]),s("vs-prompt",{attrs:{title:"Cancellation Reason","accept-text":"Continue","cancel-text":"Cancel",color:"secondary",active:e.cancellationForm},on:{cancel:function(t){e.cancellationReason=null},accept:function(t){return e.rejectOrder()},"update:active":function(t){e.cancellationForm=t}}},[s("div",[s("vs-input",{staticClass:"mt-3 w-full",attrs:{placeholder:"Reason"},model:{value:e.cancellationReason,callback:function(t){e.cancellationReason=t},expression:"cancellationReason"}})],1)])],1)},a=[],i=s("bb36"),o=s("4a7a"),c=s.n(o),n=s("2567"),d=s("82be"),l={components:{Table:d["a"],vSelect:c.a},data:function(){return{selectedOrder:{},orders:[],orderDetailsVisible:!1,itemsPerPage:4,isMounted:!1,showOrderFormSidebar:!1,sidebarData:{},selectedOrderRegionId:{id:null,region_name:"All Regions"},availableRegions:[],orderFormDialog:!1,cartProducts:[],quantity:1,selectedOrderProduct:null,selectedOrderProductVariant:null,products:[],productVariants:[],customerQuery:"",customers:[],selectedOrderCustomer:null,locationQuery:"",addressesRawResults:[],selectedOrderAddress:null,availableStaff:[],selectedStaff:{},cancellationReason:"",cancellationForm:!1}},watch:{selectedOrderRegionId:function(e){this.fetchOrders()},locationQuery:function(e){this.searchLocations()},customerQuery:function(e){this.searchCustomer()}},computed:{currentPage:function(){return this.isMounted?this.$refs.table.currentx:0},addresses:function(){return this.addressesRawResults.map((function(e){var t={};return"places"===e.type&&(t.location_name=e.searchable.place_name,t.place_id=e.searchable.id),"districts"===e.type&&(t.location_name=e.searchable.district_name,t.district_id=e.searchable.id),"regions"===e.type&&(t.location_name=e.searchable.region_name,t.region_id=e.searchable.id),e.searchable.place&&(t.location_name=t.location_name+" "+e.searchable.district.district_name,t.place_id=e.searchable.id),e.searchable.district&&(t.location_name=t.location_name+" "+e.searchable.district.district_name,t.district_id=e.searchable.district.id),e.searchable.region&&(t.location_name=t.location_name+" "+e.searchable.region.region_name,t.region_id=e.searchable.region.id),e.searchable.country&&(t.location_name=t.location_name+" "+e.searchable.region.region_name,t.country_id=e.searchable.country.id),t}))}},methods:{fetchOrders:function(){var e=this;console.log(JSON.stringify(this.selectedOrderRegionId)),this.rawCustomers=[],this.$vs.loading({background:this.backgroundLoading,container:"#customerLoading",scale:.45}),console.info("fetching customers.."),i["a"].get("/resources/sales/orders?region_id="+this.selectedOrderRegionId).then((function(t){e.orders=t.data.payload.orders.data,e.$vs.loading.close("#customerLoading > .con-vs-loading")})).catch((function(t){console.log(t),e.handleApiError(t)}))},fetchOrderDetails:function(){var e=this;console.info("fetching details.."),i["a"].get("/resources/sales/order?id="+this.selectedOrder.id).then((function(t){e.selectedOrder=t.data.payload.order})).catch((function(t){console.log(t),e.handleApiError(t)}))},confirmCustomerDeletion:function(e){this.customerInstance=e,this.$vs.dialog({type:"confirm",color:"danger",title:"Confirm",text:"Are you sure you want to remove "+this.customerInstance.customer_name,accept:this.removeCustomer})},showOrderForm:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.orderFormDialog=!0,this.orderInstance=e},closeOrderForm:function(){this.orderFormDialog=!1},addProductToCart:function(){var e={product:this.selectedOrderProduct,productVariant:this.selectedOrderProductVariant,quantity:this.quantity};this.selectedOrderProduct=null,this.selectedOrderProductVariant=null,this.quantity=1,this.cartProducts.push(e)},removeFromCart:function(e){console.log(e),this.cartProducts.splice(e,1)},submitOrder:function(){var e=this;if(this.selectedOrderCustomer)if(this.selectedOrderAddress){var t=this.cartProducts.map((function(e){return{id:e.productVariant.id,quantity:e.quantity}})),s={customer_id:this.selectedOrderCustomer.id,region_id:this.selectedOrderAddress.region_id,district_id:this.selectedOrderAddress.district_id,place_id:this.selectedOrderAddress.place_id,product_variants:t};console.log(JSON.stringify(s)),i["a"].post("/sales/order/add",s).then((function(t){e.closeOrderForm(),e.happilyNotify("Order Added"),e.fetchOrders()})).catch((function(t){console.log(t),e.handleApiError(t)}))}else this.sadlyNotify("Select address");else this.sadlyNotify("Select customer")},showOrderDetails:function(){this.$router.push({name:"sales-order-details",params:{passedOrder:this.selectedOrder}})},closeOrderDetails:function(){this.orderDetailsVisible=!1},setSalesPerson:function(){var e=this;i["a"].post("/sales/order/staff",{id:this.selectedOrder.id,staff_id:this.selectedStaff.id}).then((function(t){t.data.success&&(e.customers=t.data.payload.customers,e.happilyNotify("Updated"),e.fetchOrderDetails())})).catch((function(t){console.log(t),e.handleApiError(t)}))},promptCancellation:function(){this.cancelletionReason="",this.cancellationForm=!0},rejectOrder:function(){var e=this;i["a"].post("/sales/order/cancel",{id:this.selectedOrder.id,cancellationReason:this.cancellationReason}).then((function(t){t.data.success&&(e.customers=t.data.payload.customers,e.happilyNotify("Updated"),e.fetchOrderDetails())})).catch((function(t){console.log(t),e.handleApiError(t)}))},fetchRegions:function(){var e=this;console.info("fetching regions.."),console.info(JSON.stringify(this.selectedOrderCustomer)),i["a"].get("/resources/addresses/regions?country_id=1").then((function(t){e.availableRegions=t.data.payload.regions,e.availableRegions.unshift({id:null,region_name:"All Regions"})})).catch((function(e){console.log(e)}))},fetchProducts:function(){var e=this;i["a"].get("/resources/products/products?category_id=").then((function(t){e.products=t.data.payload.products.data})).catch((function(e){console.log(e)}))},fetchProductVariants:function(){var e=this;this.productVariants=[],this.selectedOrderProductVariant=null,i["a"].get("/resources/product/variants?product_id="+this.selectedOrderProduct.id).then((function(t){e.productVariants=t.data.payload.product_variants})).catch((function(t){console.log(t),e.handleApiError(t)}))},fetchStaff:function(){var e=this;console.info("fetching staff.."),console.info(JSON.stringify(this.selectedDepot)),i["a"].post("/resources/staff/get").then((function(t){e.availableStaff=t.data.payload.staff})).catch((function(e){console.log(e)}))},searchCustomer:function(){var e=this;console.log("Finding customer..."),this.customers=[],this.customerQuery&&i["a"].get("/resources/sales/customer/find?query="+this.customerQuery).then((function(t){t.data.success&&(e.customers=t.data.payload.customers)})).catch((function(t){console.log(t),e.handleApiError(t)}))},pickCustomer:function(e){this.customers=[],this.selectedOrderCustomer=e},removeCustomer:function(){this.selectedOrderCustomer=null},searchLocations:function(){var e=this;this.addressesRawResults=[],this.locationQuery&&i["a"].post("/resources/addresses/find",{query:this.locationQuery}).then((function(t){t.data.success&&(e.addressesRawResults=t.data.payload.addresses)})).catch((function(e){console.log(e)}))},pickAddress:function(e){this.addressesRawResults=[],this.selectedOrderAddress=e},removeAddress:function(){this.selectedOrderAddress=null},handleApiError:function(e){this.$vs.notify({title:"Error",text:Object(n["a"])(e),iconPack:"feather",icon:"icon-alert-circle",color:"danger"})},happilyNotify:function(e){this.$vs.notify({title:"Success",text:e,color:"success"})},sadlyNotify:function(e){this.$vs.notify({title:"Error",text:e,color:"danger",position:"bottom-left"})}},created:function(){this.fetchProducts(),this.fetchStaff()},mounted:function(){this.fetchOrders(),this.isMounted=!0}},u=l,m=(s("1b1e"),s("2877")),v=Object(m["a"])(u,r,a,!1,null,null,null);t["default"]=v.exports}}]);
//# sourceMappingURL=chunk-5a44ed78.a6121397.js.map