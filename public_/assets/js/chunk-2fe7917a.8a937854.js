(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2fe7917a"],{1775:function(e,t,r){},bd6b:function(e,t,r){"use strict";r("1775")},effa:function(e,t,r){"use strict";r.r(t);var s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"data-list-container",attrs:{id:"data-list-list-view"}},[r("div",{staticClass:"flex flex-wrap-reverse items-center flex-grow justify-between mb-6"},[r("div",{staticClass:"flex  "},[r("vs-icon",{staticClass:"mr-2",attrs:{icon:"shopping_cart",size:"large",color:"primary"}}),r("h1",{staticClass:"mr-6"},[e._v("\n        Order Details\n      ")])],1),e.selectedOrder.is_cancelled?r("vs-chip",{attrs:{color:"danger"}},[e._v("Order Cancelled ")]):r("vs-button",{attrs:{color:"warning"},on:{click:function(t){return e.confirmOrderCancellation()}}},[e._v(" Cancel Order")])],1),r("vs-card",[r("div",{staticClass:"px-6 py-12"},[r("div",{staticClass:"vx-row"},[r("div",{staticClass:"vx-col md:w-1/2"},[r("div",{staticClass:"mb-2 "},[r("span",{staticClass:"font-bold"},[e._v("Customer")])]),r("div",[r("table",[r("tr",[r("td",{staticClass:"pr-6"},[e._v("Name")]),r("td",[e._v(e._s(e.selectedOrder.customer?e.selectedOrder.customer.customer_name:"No Customer"))])]),r("tr",[r("td",{staticClass:"pr-6"},[e._v("Phone")]),r("td",[e._v("\n                  "+e._s(e.selectedOrder.customer?e.selectedOrder.customer.phone_number_1:"No Phone")+"\n                  "+e._s(e.selectedOrder.customer?e.selectedOrder.customer.phone_number_2:"")+"\n                ")])]),r("tr",[r("td",{staticClass:"pr-6"},[e._v("Email")]),r("td",[e._v("\n                  "+e._s(e.selectedOrder.customer?e.selectedOrder.customer.email:"Email")+"\n                ")])]),r("tr",[r("td",{staticClass:"pr-6"},[e._v("Address")]),r("td",[e._v("\n                  "+e._s(e.selectedOrder.place?e.selectedOrder.place.place_name:" ")+"\n                  "+e._s(e.selectedOrder.district?e.selectedOrder.district.district_name:" ")+"\n                  "+e._s(e.selectedOrder.region?e.selectedOrder.region.region_name:" ")+"\n                ")])])])]),r("div",{staticClass:"mb-6"},[r("div",{staticClass:"mb-2 mt-6"},[r("span",{staticClass:"font-bold"},[e._v("Sales Person")])]),r("table",[r("tr",[r("td",{staticClass:"pr-6"},[e._v("Name")]),r("td",[r("span",{class:e.selectedOrder.staff?"blue--text":"danger--text"},[e._v(e._s(e.selectedOrder.staff?e.selectedOrder.staff.staff_name:"No sales person"))])])]),r("tr",[r("td",{staticClass:"pr-6"},[e._v("Phone")]),r("td",[e._v(" "+e._s(e.selectedOrder.staff?e.selectedOrder.staff.phone_number:"No Phone"))])])]),r("div",{staticClass:"mt-4 mb-5 small-form",staticStyle:{"max-width":"320px"}},[r("h6",{staticClass:"mb-4"},[e._v(" "+e._s(e.selectedOrder.staff?"Change":"Assign")+" Sales Person")]),r("v-select",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{clearable:!1,options:e.availableStaff,name:"Staff",label:"staff_name",placeholder:"Select"},on:{input:function(t){return e.setSalesPerson()}},model:{value:e.selectedStaff,callback:function(t){e.selectedStaff=t},expression:"selectedStaff"}}),r("span",{directives:[{name:"show",rawName:"v-show",value:e.errors.has("Staff"),expression:"errors.has('Staff')"}],staticClass:"text-danger text-sm"},[e._v(e._s(e.errors.first("Staff")))])],1)])]),e.selectedOrder.order_products?r("div",{staticClass:"vx-col md:w-1/2 "},[r("div",{staticClass:"mb-6"},[r("span",{staticClass:"font-bold"},[e._v("Ordered Products")])]),e._l(e.selectedOrder.order_products,(function(t,s){return r("vx-card",{key:s,staticClass:"overflow-hidden mb-6"},[r("div",{attrs:{slot:"no-body"},slot:"no-body"},[r("div",{staticClass:"p-6 flex justify-between flex-row-reverse items-center"},[e.selectedOrder.is_cancelled||t.is_rejected||t.delivered_quantity>=t.ordered_quantity?e.selectedOrder.is_cancelled?r("vs-chip",{staticClass:" inline-flex",attrs:{color:"black"}},[e._v("Order Cancelled ")]):t.is_rejected?r("vs-chip",{staticClass:" inline-flex",attrs:{color:"grey"}},[e._v("Product Rejected ")]):e._e():r("vs-button",{staticClass:"p-3 inline-flex",attrs:{color:"secondary"},on:{click:function(r){return e.showAvailableProductsToDeliver(t)}}},[e._v("Deliver Products")]),t.delivered_quantity>=t.ordered_quantity?r("vs-chip",{staticClass:" inline-flex",attrs:{color:"success"}},[e._v("Fulfiled ")]):e._e(),r("div",{staticClass:"truncate"},[r("h3",{staticClass:"mb-1 font-bold"},[e._v("\n                    "+e._s(t.product?t.product.product_name:"")+"\n                    "+e._s(t.variant?t.variant.variant_name:" ")+"\n                  ")]),r("ul",[r("li",[e._v("Quantity "+e._s(t.ordered_quantity))]),r("li",[e._v("Delivered: "+e._s(t.delivered_quantity))]),r("li",[e._v("@TSH"+e._s(t.selling_price))]),e.selectedOrder.is_cancelled||t.is_rejected||t.delivered_quantity>=t.ordered_quantity?e._e():r("li",[r("vs-button",{staticClass:"mt-4 py-1 px-2",attrs:{type:"border"},on:{click:function(r){return e.confirmOrderItemRejection(t)}}},[e._v("Reject Item")])],1)])])],1)])])}))],2):e._e()])])]),r("vs-prompt",{attrs:{title:"Delivery","accept-text":"Delivery","cancel-text":"Cancel",color:"#118ab2",active:e.deliveryForm},on:{cancel:function(t){e.selectedTruckedProduct=null},accept:function(t){return e.deliverProduct()},"update:active":function(t){e.deliveryForm=t}}},[e.selectedTruckedProduct?r("h4",{staticClass:"my-6"},[e._v("Quantity to deliver")]):r("h4",{staticClass:"my-6"},[e._v("Select stock")]),e.selectedTruckedProduct?r("div",{staticClass:"mb-6"},[r("vs-input",{staticClass:"mt-3 w-full",attrs:{placeholder:"Quantity","vs-placeholder":"Quantity"},model:{value:e.quantityToDeliver,callback:function(t){e.quantityToDeliver=t},expression:"quantityToDeliver"}})],1):e._e(),e.selectedTruckedProduct?r("div",{staticClass:"product-item-active"},[r("p",[e._v("\n        "+e._s(e.selectedTruckedProduct.product?e.selectedTruckedProduct.product.product_name:"")+"\n        "+e._s(e.selectedTruckedProduct.variant?e.selectedTruckedProduct.variant.variant_name:"")+"\n      ")]),r("p",[e._v("Remaining: "+e._s(e.selectedTruckedProduct.remaining_quantity)+" ")]),r("p",[e._v("Created at: "+e._s(e.selectedTruckedProduct.created_at)+" ")])]):r("div",e._l(e.availableTruckedProducts,(function(t,s){return r("div",{key:s,staticClass:"product-item",on:{click:function(r){e.selectedTruckedProduct=t}}},[r("div",[r("p",[e._v("\n           "+e._s(t.product?t.product.product_name:"")+"\n           "+e._s(t.variant?t.variant.variant_name:"")+"\n         ")]),r("p",[e._v("Remaining: "+e._s(t.remaining_quantity)+" ")])])])})),0),0===e.availableTruckedProducts.length?r("div",{staticClass:"my-6"},[r("span",{staticStyle:{color:"#e60000"}},[e._v("No stock available in requested depot ")])]):e._e()])],1)},a=[],c=r("bb36"),i=r("4a7a"),d=r.n(i),o=r("2567"),n=r("82be"),l={props:{passedOrder:Object},components:{Table:n["a"],vSelect:d.a},data:function(){return{selectedOrder:{},orders:[],orderDetailsVisible:!1,itemsPerPage:4,isMounted:!1,showOrderFormSidebar:!1,sidebarData:{},selectedOrderRegionId:{id:null,region_name:"All Regions"},availableRegions:[],deliveryForm:!1,cartProducts:[],quantity:1,selectedOrderProduct:null,selectedOrderProductVariant:null,products:[],productVariants:[],customerQuery:"",customers:[],selectedOrderCustomer:null,locationQuery:"",addressesRawResults:[],selectedOrderAddress:null,availableStaff:[],selectedStaff:{},cancellationReason:"",cancellationForm:!1,selectedOrderedProduct:null,selectedTruckedProduct:null,availableTruckedProducts:[],quantityToDeliver:null}},watch:{selectedOrderRegionId:function(e){this.fetchOrders()},locationQuery:function(e){this.searchLocations()},customerQuery:function(e){this.searchCustomer()}},computed:{currentPage:function(){return this.isMounted?this.$refs.table.currentx:0},addresses:function(){return this.addressesRawResults.map((function(e){var t={};return"places"===e.type&&(t.location_name=e.searchable.place_name,t.place_id=e.searchable.id),"districts"===e.type&&(t.location_name=e.searchable.district_name,t.district_id=e.searchable.id),"regions"===e.type&&(t.location_name=e.searchable.region_name,t.region_id=e.searchable.id),e.searchable.place&&(t.location_name=t.location_name+" "+e.searchable.district.district_name,t.place_id=e.searchable.id),e.searchable.district&&(t.location_name=t.location_name+" "+e.searchable.district.district_name,t.district_id=e.searchable.district.id),e.searchable.region&&(t.location_name=t.location_name+" "+e.searchable.region.region_name,t.region_id=e.searchable.region.id),e.searchable.country&&(t.location_name=t.location_name+" "+e.searchable.region.region_name,t.country_id=e.searchable.country.id),t}))}},methods:{fetchOrderDetails:function(){var e=this;console.info("fetching details.."),c["a"].get("/resources/sales/order?id="+this.passedOrder.id).then((function(t){e.selectedOrder=t.data.payload.order})).catch((function(t){console.log(t),e.handleApiError(t)}))},showAvailableProductsToDeliver:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.selectedOrderedProduct=t,this.selectedOrderedProduct.delivered_quantity>=this.selectedOrderedProduct.ordered_quantity?this.happilyNotify("Order Already fulfilled"):(this.deliveryForm=!0,c["a"].post("/sales/order/delivery/available",{order_product_id:this.selectedOrderedProduct.id}).then((function(t){e.availableTruckedProducts=t.data.payload})).catch((function(t){console.log(t),e.handleApiError(t)})))},deliverProduct:function(){var e=this;c["a"].post("/sales/order/delivery/deliver",{order_product_id:this.selectedOrderedProduct.id,trucked_product_id:this.selectedTruckedProduct.id,quantity:this.quantityToDeliver}).then((function(t){e.selectedTruckedProduct=null,e.selectedOrderedProduct=null,e.quantity=null,e.happilyNotify("Product delivered"),e.fetchOrderDetails()})).catch((function(t){console.log(t),e.handleApiError(t)}))},setSalesPerson:function(){var e=this;c["a"].post("/sales/order/staff",{id:this.selectedOrder.id,staff_id:this.selectedStaff.id}).then((function(t){t.data.success&&(e.customers=t.data.payload.customers,e.happilyNotify("Updated"),e.fetchOrderDetails())})).catch((function(t){console.log(t),e.handleApiError(t)}))},promptCancellation:function(){this.cancelletionReason="",this.cancellationForm=!0},confirmOrderCancellation:function(){this.$vs.dialog({type:"confirm",color:"danger",title:"Confirm",text:"Are you sure you want to cancel this order",accept:this.rejectOrder})},rejectOrder:function(){var e=this;c["a"].post("/sales/order/cancel",{id:this.selectedOrder.id,cancellationReason:this.cancellationReason}).then((function(t){t.data.success&&(e.customers=t.data.payload.customers,e.happilyNotify("Updated"),e.fetchOrderDetails())})).catch((function(t){console.log(t),e.handleApiError(t)}))},confirmOrderItemRejection:function(e){this.selectedOrderProduct=e,this.$vs.dialog({type:"confirm",color:"danger",title:"Confirm",text:"Are you sure you want to reject this item",accept:this.rejectOrderItem})},rejectOrderItem:function(){var e=this;c["a"].post("/sales/order/item/reject",{id:this.selectedOrderProduct.id}).then((function(t){t.data.success&&(e.happilyNotify("Order updated"),e.fetchOrderDetails())})).catch((function(t){console.log(t),e.handleApiError(t)}))},fetchProducts:function(){var e=this;c["a"].get("/resources/products/products?category_id=").then((function(t){e.products=t.data.payload.products.data})).catch((function(e){console.log(e)}))},fetchStaff:function(){var e=this;console.info("fetching staff.."),console.info(JSON.stringify(this.selectedDepot)),c["a"].post("/resources/staff/get").then((function(t){e.availableStaff=t.data.payload.staff})).catch((function(e){console.log(e)}))},fetchProductVariants:function(){var e=this;this.productVariants=[],this.selectedOrderProductVariant=null,c["a"].get("/resources/product/variants?product_id="+this.selectedOrderProduct.id).then((function(t){e.productVariants=t.data.payload.product_variants})).catch((function(t){console.log(t),e.handleApiError(t)}))},searchCustomer:function(){var e=this;console.log("Finding customer..."),this.customers=[],this.customerQuery&&c["a"].get("/resources/sales/customer/find?query="+this.customerQuery).then((function(t){t.data.success&&(e.customers=t.data.payload.customers)})).catch((function(t){console.log(t),e.handleApiError(t)}))},pickCustomer:function(e){this.customers=[],this.selectedOrderCustomer=e},removeCustomer:function(){this.selectedOrderCustomer=null},searchLocations:function(){var e=this;this.addressesRawResults=[],this.locationQuery&&c["a"].post("/resources/addresses/find",{query:this.locationQuery}).then((function(t){t.data.success&&(e.addressesRawResults=t.data.payload.addresses)})).catch((function(e){console.log(e)}))},pickAddress:function(e){this.addressesRawResults=[],this.selectedOrderAddress=e},removeAddress:function(){this.selectedOrderAddress=null},handleApiError:function(e){this.$vs.notify({title:"Error",text:Object(o["a"])(e),iconPack:"feather",icon:"icon-alert-circle",color:"danger"})},happilyNotify:function(e){this.$vs.notify({title:"Success",text:e,color:"success"})},sadlyNotify:function(e){this.$vs.notify({title:"Error",text:e,color:"danger",position:"bottom-left"})}},created:function(){this.fetchStaff()},mounted:function(){this.isMounted=!0,null!=this.passedOrder?(console.log("orderId:"+this.passedOrder.id),this.fetchOrderDetails()):(console.info("Order id not found, going back"),this.$router.go(-1))}},u=l,f=(r("bd6b"),r("2877")),h=Object(f["a"])(u,s,a,!1,null,null,null);t["default"]=h.exports}}]);
//# sourceMappingURL=chunk-2fe7917a.8a937854.js.map